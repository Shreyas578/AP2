<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AP2 Payment System - Agent-Based USDC Payments</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>üéØ AP2 Payment System</h1>
                    <p class="subtitle">Agent-Based Authorization + Settlement</p>
                </div>
                <div class="header-actions">
                    <div class="network-indicator" id="networkIndicator">
                        <span class="status-dot"></span>
                        <span class="network-text">Not Connected</span>
                    </div>
                    <button class="btn btn-primary" id="connectWalletBtn">
                        <span class="btn-icon">üîê</span>
                        Connect Wallet
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h2 class="hero-title">Clean, Reusable Payment Pattern</h2>
                <p class="hero-description">
                    Intent ‚Üí Authorization ‚Üí Settlement ‚Üí Receipt
                </p>
                <div class="hero-stats">
                    <div class="stat">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Agent Services</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">2</div>
                        <div class="stat-label">Smart Contracts</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">100%</div>
                        <div class="stat-label">On-Chain Verified</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Wallet Info Panel -->
    <div class="wallet-panel" id="walletPanel" style="display: none;">
        <div class="container">
            <div class="wallet-grid">
                <div class="wallet-card">
                    <div class="wallet-label">Connected Address</div>
                    <div class="wallet-value" id="walletAddress">0x...</div>
                </div>
                <div class="wallet-card highlight">
                    <div class="wallet-label">üíµ USDC Balance</div>
                    <div class="wallet-value large" id="usdcBalance">0.00</div>
                </div>
                <div class="wallet-card">
                    <div class="wallet-label">ETH Balance</div>
                    <div class="wallet-value" id="ethBalance">0.00</div>
                </div>
                <div class="wallet-card">
                    <div class="wallet-label">USDC Allowance</div>
                    <div class="wallet-value" id="usdcAllowance">0.00</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main">
        <div class="container">

            <!-- Agent Flow Visualization -->
            <section class="flow-section">
                <h2 class="section-title">üîÑ Agent Workflow</h2>
                <div class="agent-flow">
                    <div class="agent-step" data-step="1">
                        <div class="step-icon">üõí</div>
                        <div class="step-content">
                            <h3>Shopping Agent</h3>
                            <p>Creates payment intent</p>
                        </div>
                        <div class="step-status" id="step1Status"></div>
                    </div>

                    <div class="flow-arrow">‚Üí</div>

                    <div class="agent-step" data-step="2">
                        <div class="step-icon">üè™</div>
                        <div class="step-content">
                            <h3>Merchant Agent</h3>
                            <p>Signs cart mandate</p>
                        </div>
                        <div class="step-status" id="step2Status"></div>
                    </div>

                    <div class="flow-arrow">‚Üí</div>

                    <div class="agent-step critical" data-step="3">
                        <div class="step-icon">üîê</div>
                        <div class="step-content">
                            <h3>Credentials Provider</h3>
                            <p><strong>AP2 Authorization</strong></p>
                        </div>
                        <div class="step-status" id="step3Status"></div>
                    </div>

                    <div class="flow-arrow">‚Üí</div>

                    <div class="agent-step" data-step="4">
                        <div class="step-icon">üí∏</div>
                        <div class="step-content">
                            <h3>Settlement Agent</h3>
                            <p>Executes x402 transfer</p>
                        </div>
                        <div class="step-status" id="step4Status"></div>
                    </div>

                    <div class="flow-arrow">‚Üí</div>

                    <div class="agent-step" data-step="5">
                        <div class="step-icon">üßæ</div>
                        <div class="step-content">
                            <h3>Receipt Generator</h3>
                            <p>Creates audit record</p>
                        </div>
                        <div class="step-status" id="step5Status"></div>
                    </div>
                </div>
            </section>

            <!-- Demo Controls -->
            <section class="demo-section">
                <h2 class="section-title">üéÆ Interactive Demo</h2>

                <div class="demo-grid">
                    <!-- Shopping Cart -->
                    <div class="demo-card">
                        <h3 class="card-title">
                            <span class="card-icon">üõçÔ∏è</span>
                            Shopping Cart
                        </h3>
                        <div class="product-select">
                            <label for="productSelect">Select Product (58 items available)</label>
                            <select id="productSelect" class="input">
                                <optgroup label="üí∞ Budget Items ($1-$5) - 15 items">
                                    <option value="tea-bag">Single Tea Bag - $1 USDC</option>
                                    <option value="honey-stick">Honey Stick - $1.50 USDC</option>
                                    <option value="fruit-snack">Fruit Snack Pack - $1.75 USDC</option>
                                    <option value="coffee-sample">Coffee Sample Pack - $2 USDC</option>
                                    <option value="salt-sample">Sea Salt Sample - $2 USDC</option>
                                    <option value="chocolate-square">Chocolate Square - $2.50 USDC</option>
                                    <option value="mint-tin">Mint Tin - $2.50 USDC</option>
                                    <option value="energy-bar">Energy Bar - $2.75 USDC</option>
                                    <option value="spice-packet">Spice Packet - $3 USDC</option>
                                    <option value="gum-pack">Chewing Gum Pack - $3 USDC</option>
                                    <option value="rice-cake">Rice Cake Pack - $3.25 USDC</option>
                                    <option value="cookie">Artisan Cookie - $3.50 USDC</option>
                                    <option value="granola-bar">Organic Granola Bar - $4 USDC</option>
                                    <option value="trail-mix">Trail Mix Packet - $4.50 USDC</option>
                                    <option value="beef-jerky">Beef Jerky - $5 USDC</option>
                                </optgroup>
                                <optgroup label="üõí Affordable Items ($5-$15) - 15 items">
                                    <option value="tea-box">Tea Box (20 bags) - $6 USDC</option>
                                    <option value="popcorn">Gourmet Popcorn - $6.50 USDC</option>
                                    <option value="chocolate-bar">Chocolate Bar - $7 USDC</option>
                                    <option value="crackers">Artisan Crackers - $7.50 USDC</option>
                                    <option value="coffee-bag">Coffee Bag (250g) - $8 USDC</option>
                                    <option value="dried-fruit">Dried Fruit Mix - $8.50 USDC</option>
                                    <option value="nuts-pack">Mixed Nuts Pack - $9 USDC</option>
                                    <option value="jam-jar">Fruit Jam Jar - $9.50 USDC</option>
                                    <option value="oats">Steel Cut Oats - $9.75 USDC</option>
                                    <option value="honey-jar-small">Small Honey Jar - $10 USDC</option>
                                    <option value="pasta-pack">Artisan Pasta - $11 USDC</option>
                                    <option value="chia-seeds">Chia Seeds - $11.50 USDC</option>
                                    <option value="protein-bar">Protein Bar (6-pack) - $12 USDC</option>
                                    <option value="rice-bag">Organic Rice (1kg) - $13 USDC</option>
                                    <option value="quinoa">Quinoa Pack (500g) - $14.50 USDC</option>
                                </optgroup>
                                <optgroup label="üåü Mid-Range Items ($15-$30) - 13 items">
                                    <option value="peanut-butter">Peanut Butter - $13.50 USDC</option>
                                    <option value="mustard">Dijon Mustard - $12.50 USDC</option>
                                    <option value="hot-sauce">Artisan Hot Sauce - $14 USDC</option>
                                    <option value="sea-salt">Himalayan Sea Salt - $15 USDC</option>
                                    <option value="pasta-sauce">Artisan Pasta Sauce - $16 USDC</option>
                                    <option value="tahini">Tahini Paste - $16.50 USDC</option>
                                    <option value="almond-butter">Almond Butter - $17 USDC</option>
                                    <option value="organic-honey">Organic Honey Jar - $18 USDC</option>
                                    <option value="coconut-oil">Coconut Oil - $19 USDC</option>
                                    <option value="maple-syrup-small">Maple Syrup (250ml) - $20 USDC</option>
                                    <option value="olive-oil-small">Olive Oil (250ml) - $22 USDC</option>
                                    <option value="balsamic-small">Balsamic Vinegar (250ml) - $24 USDC</option>
                                    <option value="spice-set-small">Spice Set (5 pack) - $25 USDC</option>
                                </optgroup>
                                <optgroup label="üíé Premium Items ($30+) - 15 items">
                                    <option value="artisan-tea">Artisan Tea Collection - $35 USDC</option>
                                    <option value="champagne-vinegar">Champagne Vinegar - $38 USDC</option>
                                    <option value="maple-syrup">Pure Maple Syrup (500ml) - $40 USDC</option>
                                    <option value="matcha-powder">Ceremonial Matcha Powder - $42 USDC</option>
                                    <option value="craft-chocolate">Craft Chocolate Bar - $45 USDC</option>
                                    <option value="balsamic-vinegar">Aged Balsamic Vinegar (500ml) - $48 USDC</option>
                                    <option value="premium-coffee">Premium Coffee Beans (1kg) - $50 USDC</option>
                                    <option value="truffle-salt">Black Truffle Salt - $52 USDC</option>
                                    <option value="olive-oil">Extra Virgin Olive Oil (750ml) - $55 USDC</option>
                                    <option value="specialty-spices">Specialty Spice Set - $60 USDC</option>
                                    <option value="vanilla-extract">Madagascar Vanilla Extract - $65 USDC</option>
                                    <option value="wagyu-jerky">Wagyu Beef Jerky - $68 USDC</option>
                                    <option value="saffron">Saffron Threads - $75 USDC</option>
                                    <option value="truffle-oil">White Truffle Oil - $85 USDC</option>
                                    <option value="caviar">Caviar Tin - $95 USDC</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="amount-input">
                            <label for="amountInput">Amount (USDC)</label>
                            <input type="number" id="amountInput" class="input" value="1" min="0.01" max="1000"
                                step="0.01">
                        </div>
                        <div class="merchant-input">
                            <label for="merchantAddress">Merchant Address</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" id="merchantAddress" class="input" placeholder="0x..."
                                    style="flex: 1;">
                                <button class="btn btn-sm btn-secondary" id="resetMerchantBtn"
                                    title="Reset to default merchant">
                                    üîÑ
                                </button>
                            </div>
                        </div>

                        <!-- Cart Actions -->
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            <button class="btn btn-secondary btn-block" id="addToCartBtn">
                                <span class="btn-icon">üõí</span>
                                Add to Cart
                            </button>
                            <button class="btn btn-secondary" id="viewCartBtn">
                                <span class="btn-icon">üëÅÔ∏è</span>
                                View Cart (<span id="cartCount">0</span>)
                            </button>
                        </div>

                        <!-- Cart Display -->
                        <div id="cartDisplay"
                            style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 0.5rem;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <h4 style="margin: 0;">Cart Items</h4>
                                <button class="btn btn-sm btn-secondary" id="clearCartBtn">Clear</button>
                            </div>
                            <div id="cartItems"></div>
                            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                                <div
                                    style="display: flex; justify-content: space-between; font-size: 1.125rem; font-weight: 600;">
                                    <span>Total:</span>
                                    <span id="cartTotal">$0.00 USDC</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="demo-card">
                        <h3 class="card-title">
                            <span class="card-icon">‚ö°</span>
                            Actions
                        </h3>
                        <div class="action-buttons">
                            <button class="btn btn-success btn-block" id="runSuccessBtn" disabled
                                style="display: none;">
                                <span class="btn-icon">‚úÖ</span>
                                Buy Single Item
                            </button>
                            <button class="btn btn-success btn-block" id="payCartBtn" disabled>
                                <span class="btn-icon">üõí</span>
                                Pay for Cart
                            </button>
                            <button class="btn btn-info btn-block" id="generateQRBtn" disabled>
                                <span class="btn-icon">üì±</span>
                                Generate QR Code
                            </button>
                            <button class="btn btn-warning btn-block" id="refundDemoBtn" disabled>
                                <span class="btn-icon">‚Ü©Ô∏è</span>
                                Refund Last Transaction
                            </button>
                            <button class="btn btn-warning btn-block" id="runFailureBtn" disabled>
                                <span class="btn-icon">‚ö†Ô∏è</span>
                                Demo Signature Attack
                            </button>
                            <button class="btn btn-secondary btn-block" id="approveUsdcBtn" disabled>
                                <span class="btn-icon">üîì</span>
                                Approve USDC
                            </button>
                            <button class="btn btn-info btn-block" id="refreshBalanceBtn" disabled>
                                <span class="btn-icon">üîÑ</span>
                                Refresh Balances
                            </button>
                            <button class="btn btn-info btn-block" id="viewHistoryBtn" disabled>
                                <span class="btn-icon">üìä</span>
                                Payment History
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Status Console -->
            <section class="console-section">
                <div class="console-header">
                    <h3>üìä Status Console</h3>
                    <button class="btn btn-sm" id="clearConsoleBtn">Clear</button>
                </div>
                <div class="console-output" id="consoleOutput">
                    <div class="console-message info">
                        <span class="timestamp">[Ready]</span>
                        <span class="message">Connect your wallet to begin...</span>
                    </div>
                </div>
            </section>

            <!-- Payment History Section -->
            <section class="history-section" id="historySection" style="display: none;">
                <h2 class="section-title">üìä Payment History</h2>
                <div class="history-controls" style="margin-bottom: 1rem; display: flex; gap: 0.5rem;">
                    <button class="btn btn-secondary" id="loadHistoryBtn">
                        <span class="btn-icon">üîÑ</span>
                        Reload
                    </button>
                    <button class="btn btn-secondary" id="exportHistoryBtn">
                        <span class="btn-icon">üì•</span>
                        Export CSV
                    </button>
                </div>
                <div class="history-container" style="overflow-x: auto;">
                    <table class="history-table"
                        style="width: 100%; border-collapse: collapse; background: var(--bg-secondary); border-radius: 0.5rem;">
                        <thead>
                            <tr style="background: var(--bg-tertiary); text-align: left;">
                                <th style="padding: 0.75rem;">Date</th>
                                <th style="padding: 0.75rem;">Amount</th>
                                <th style="padding: 0.75rem;">Merchant</th>
                                <th style="padding: 0.75rem;">Status</th>
                                <th style="padding: 0.75rem;">TX</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                    Click "Load History" to view transactions
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- QR Code Section -->
            <section class="qr-section" id="qrSection" style="display: none;">
                <h2 class="section-title">üì± Payment QR Code</h2>
                <div class="qr-container"
                    style="background: var(--bg-secondary); padding: 2rem; border-radius: 0.5rem; text-align: center;">
                    <div id="qrCode"
                        style="display: inline-block; padding: 1rem; background: white; border-radius: 0.5rem; margin-bottom: 1rem;">
                    </div>
                    <div style="margin-top: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Payment
                            Link:</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" id="qrLink" class="input" readonly
                                style="flex: 1; font-family: monospace; font-size: 0.875rem;">
                            <button class="btn btn-secondary" id="copyQRBtn">
                                <span class="btn-icon">üìã</span>
                                Copy
                            </button>
                        </div>
                    </div>
                    <div
                        style="margin-top: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 0.5rem; text-align: left;">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.875rem;">
                            <strong>üì± How to use:</strong><br>
                            ‚Ä¢ Scan QR code with mobile device<br>
                            ‚Ä¢ Opens payment page with pre-filled details<br>
                            ‚Ä¢ Connect wallet and approve payment<br>
                            ‚Ä¢ Works on both web and mobile browsers
                        </p>
                    </div>
                </div>
            </section>

            <!-- Receipt Viewer -->
            <section class="receipt-section" id="receiptSection" style="display: none;">
                <h2 class="section-title">üßæ Payment Receipt</h2>
                <div class="receipt-container">
                    <div class="receipt-header">
                        <div class="receipt-status" id="receiptStatus">SUCCESS</div>
                        <div class="receipt-timestamp" id="receiptTimestamp"></div>
                    </div>
                    <div class="receipt-body">
                        <pre class="receipt-json" id="receiptJson"></pre>
                    </div>
                    <div class="receipt-actions">
                        <button class="btn btn-secondary" id="downloadReceiptBtn">
                            <span class="btn-icon">üì•</span>
                            Download JSON
                        </button>
                        <button class="btn btn-secondary" id="viewOnExplorerBtn">
                            <span class="btn-icon">üîç</span>
                            View on BaseScan
                        </button>
                    </div>
                </div>
            </section>

            <!-- Contract Info -->
            <section class="info-section">
                <h2 class="section-title">üìã Contract Information</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">Network</div>
                        <div class="info-value">Base Sepolia (84532)</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">USDC Contract</div>
                        <div class="info-value mono">0x036CbD...f7e</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">PaymentProcessor</div>
                        <div class="info-value mono" id="processorAddress">Not deployed</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ReceiptRegistry</div>
                        <div class="info-value mono" id="registryAddress">Not deployed</div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 AP2 Payment System | Built for AP2 + x402 Hackathon</p>
            <div class="footer-links">
                <a href="https://github.com" target="_blank">GitHub</a>
                <a href="https://sepolia.basescan.org" target="_blank">BaseScan</a>
                <a href="../README.md">Documentation</a>
            </div>
        </div>
    </footer>

    <!-- Loading Modal -->
    <div class="modal" id="loadingModal" style="display: none;">
        <div class="modal-content">
            <div class="loader"></div>
            <p id="loadingText">Processing...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="config.js"></script>
    <script src="cart.js"></script>
    <script src="agents.js"></script>
    <script src="app.js"></script>
</body>

</html>